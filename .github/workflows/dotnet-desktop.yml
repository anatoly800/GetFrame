name: .NET Core Desktop

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:

  build:

    strategy:
      matrix:
        configuration: [Debug, Release]

    runs-on: windows-latest

    env:
      Solution_Name: GetFrame.slnx
      BuildProjectWin: GetFrame.Windows/GetFrame.Windows.csproj
      BuildProjectAndroid: GetFrame.Android/GetFrame.Android.csproj

    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Install .NET Core
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 9.0.x

    - name: Install Android workload
      run: dotnet workload install android

    - name: Setup MSBuild.exe
      uses: microsoft/setup-msbuild@v2

    - name: Restore dependencies
      run: dotnet restore $env:Solution_Name
      env:
        Configuration: ${{ matrix.configuration }}

    - name: Build Windows project
      run: dotnet build $env:BuildProjectWin -c ${{ matrix.configuration }} --no-restore

    - name: Build Android project
      run: dotnet build $env:BuildProjectAndroid -c ${{ matrix.configuration }} --no-restore

    - name: Archive Windows build artifacts
      if: always()
      run: |
        $outputDir = "GetFrame.Windows/bin/${{ matrix.configuration }}"
        if (Test-Path $outputDir) {
          Compress-Archive -Path $outputDir -DestinationPath "GetFrame.Windows-${{ matrix.configuration }}.zip" -Force
        }

    - name: Archive Android build artifacts
      if: always()
      run: |
        $outputDir = "GetFrame.Android/bin/${{ matrix.configuration }}"
        if (Test-Path $outputDir) {
          Compress-Archive -Path $outputDir -DestinationPath "GetFrame.Android-${{ matrix.configuration }}.zip" -Force
        }

    - name: Upload Windows artifacts
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: GetFrame.Windows-${{ matrix.configuration }}
        path: GetFrame.Windows-${{ matrix.configuration }}.zip
        retention-days: 7

    - name: Upload Android artifacts
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: GetFrame.Android-${{ matrix.configuration }}
        path: GetFrame.Android-${{ matrix.configuration }}.zip
        retention-days: 7

